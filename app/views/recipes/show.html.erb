<%# En-tête %>
<div class="d-flex justify-content-between align-items-center mb-4">
  <div class="d-flex align-items-center gap-2">
    <h4 class="mb-0"><%= @recipe.name %></h4>
    <% if @recipe.subrecipe? %>
      <span class="badge bg-info">Sous-recette</span>
    <% end %>
  </div>
  <div class="d-flex gap-2">
    <%# TODO: Réactiver les boutons convertir recette/sous-recette %>
    <% if false # masqué temporairement %>
      <% if @recipe.subrecipe? %>
        <%= button_to recipe_path(@recipe),
              method: :patch,
              params: { recipe: { sellable_as_component: false } },
              class: "btn btn-outline-success",
              form: { data: { turbo_confirm: "Convertir en recette ?" } } do %>
          <i class="bi bi-arrow-up-circle"></i> Convertir en recette
        <% end %>
      <% else %>
        <%= button_to recipe_path(@recipe),
              method: :patch,
              params: { recipe: { sellable_as_component: true, has_tray: false, tray_size_id: "" } },
              class: "btn btn-outline-info",
              form: { data: { turbo_confirm: "Convertir en sous-recette ?" } } do %>
          <i class="bi bi-arrow-down-circle"></i> Convertir en sous-recette
        <% end %>
      <% end %>
    <% end %>
    <%= link_to edit_recipe_path(@recipe), class: "btn btn-outline-secondary" do %>
      <i class="bi bi-pencil"></i> Modifier
    <% end %>
    <%= button_to duplicate_recipe_path(@recipe),
          method: :post,
          class: "btn btn-outline-info",
          form: { data: { turbo_confirm: "Dupliquer cette recette ?" } } do %>
      <i class="bi bi-copy"></i> Dupliquer
    <% end %>
    <%= link_to recipes_path, class: "btn btn-outline-primary" do %>
      <i class="bi bi-arrow-left"></i> Retour
    <% end %>
  </div>
</div>

<div class="row">
  <%# Colonne gauche : composants %>
  <div class="col-md-8">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Composants</h5>
      </div>
      <div class="card-body">
        <%= render "recipes/components_list", recipe: @recipe %>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Ajouter un composant</h5>
      </div>
      <div class="card-body">
        <%= render "recipe_components/form",
              recipe: @recipe,
              component: @recipe.recipe_components.build,
              available_products: current_user.products.order(:name),
              available_subrecipes: current_user.recipes
                                                .usable_as_subrecipe
                                                .where.not(id: @recipe.id)
                                                .order(:name) %>
      </div>
    </div>
  </div>

  <%# Colonne droite : résumé et infos %>
  <div class="col-md-4">
    <%= render "recipes/recipe_summary", recipe: @recipe %>

    <div class="card mt-4">
      <div class="card-header">
        <h5 class="mb-0">Informations</h5>
      </div>
      <div class="card-body">
        <% if @recipe.description.present? %>
          <p class="mb-3"><%= @recipe.description %></p>
        <% end %>

        <ul class="list-unstyled mb-0">
          <%= render "recipes/cooking_loss_form", recipe: @recipe %>
          <li class="mb-2">
            <strong>Sous-recette :</strong>
            <% if @recipe.sellable_as_component? %>
              <span class="badge bg-info">Oui</span>
            <% else %>
              Non
            <% end %>
          </li>
          <% unless @recipe.subrecipe? %>
            <li>
              <strong>Barquette :</strong>
              <% if @recipe.has_tray? %>
                <span class="badge bg-secondary">Oui</span>
                <% if @recipe.tray_size %>
                  &mdash; <%= @recipe.tray_size.name %>
                <% end %>
              <% else %>
                Non
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
