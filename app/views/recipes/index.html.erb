<%# En-tête %>
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="mb-0">Recettes</h4>
  <%= link_to new_recipe_path, class: "btn btn-primary" do %>
    <i class="bi bi-plus-lg"></i> Nouvelle recette
  <% end %>
</div>

<%# Barre de recherche %>
<%= form_with url: recipes_path, method: :get, class: "mb-4" do |f| %>
  <div class="input-group" style="max-width: 400px;">
    <%= f.text_field :search,
          value: params[:search],
          placeholder: "Rechercher une recette...",
          class: "form-control" %>
    <%= f.submit "Rechercher", class: "btn btn-outline-secondary" %>
    <% if params[:search].present? %>
      <%= link_to "✕", recipes_path, class: "btn btn-outline-danger" %>
    <% end %>
  </div>
<% end %>

<%# Tableau des recettes %>
<% if @recipes.any? %>
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Co&ucirc;t/kg</th>
          <th>Poids final</th>
          <th>Perte cuisson</th>
          <th>Sous-recette</th>
          <th>Barquette</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @recipes.each do |recipe| %>
          <tr>
            <td><%= link_to recipe.name, recipe_path(recipe) %></td>
            <td>
              <% if recipe.cached_cost_per_kg.present? && recipe.cached_cost_per_kg > 0 %>
                <%= number_with_precision(recipe.cached_cost_per_kg, precision: 2) %>&nbsp;&euro;/kg
              <% else %>
                <span class="badge bg-warning text-dark">Non calcul&eacute;</span>
              <% end %>
            </td>
            <td>
              <% if recipe.cached_total_weight.present? %>
                <%= number_with_precision(recipe.cached_total_weight, precision: 3) %>&nbsp;kg
              <% else %>
                &mdash;
              <% end %>
            </td>
            <td><%= recipe.cooking_loss_percentage || 0 %>&nbsp;%</td>
            <td>
              <% if recipe.sellable_as_component? %>
                <span class="badge bg-info">Oui</span>
              <% end %>
            </td>
            <td>
              <% if recipe.has_tray? %>
                <span class="badge bg-secondary">Oui</span>
              <% end %>
            </td>
            <td>
              <div class="d-flex gap-1">
                <%= link_to recipe_path(recipe), class: "btn btn-sm btn-outline-primary" do %>
                  <i class="bi bi-eye"></i> Voir
                <% end %>
                <%= link_to edit_recipe_path(recipe), class: "btn btn-sm btn-outline-secondary" do %>
                  <i class="bi bi-pencil"></i> Modifier
                <% end %>
                <%= button_to duplicate_recipe_path(recipe),
                      method: :post,
                      class: "btn btn-sm btn-outline-info",
                      form: { data: { turbo_confirm: "Dupliquer cette recette ?" } } do %>
                  <i class="bi bi-copy"></i> Dupliquer
                <% end %>
                <%= button_to recipe_path(recipe),
                      method: :delete,
                      class: "btn btn-sm btn-outline-danger",
                      form: { data: { turbo_confirm: "Supprimer cette recette ?" } } do %>
                  <i class="bi bi-trash"></i> Supprimer
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p class="text-muted text-center mt-4">
    <% if params[:search].present? %>
      Aucune recette trouv&eacute;e pour "<%= params[:search] %>".
    <% else %>
      Aucune recette pour le moment.
    <% end %>
  </p>
<% end %>
