<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><%= link_to "Accueil", root_path %></li>
    <li class="breadcrumb-item active">Recettes</li>
  </ol>
</nav>

<!-- En-tête -->
<div class="row mb-4">
  <div class="col-md-8">
    <h2><i class="bi bi-journal-text"></i> Mes Recettes</h2>
    <p class="text-muted">Gérez vos recettes et calculez automatiquement vos coûts matières</p>
  </div>
  <div class="col-md-4 text-end">
    <%= link_to new_recipe_path, class: "btn btn-primary btn-lg" do %>
      <i class="bi bi-plus-circle"></i> Nouvelle Recette
    <% end %>
  </div>
</div>

<!-- Barre de recherche et filtre -->
<div class="row mb-3">
  <div class="col-md-6">
    <div class="input-group">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <input type="text" class="form-control" placeholder="Rechercher une recette..." disabled>
    </div>
  </div>
  <div class="col-md-6 text-end">
    <span class="badge bg-secondary fs-6"><%= @recipes.count %> recette<%= @recipes.count > 1 ? 's' : '' %></span>
  </div>
</div>

<% if @recipes.empty? %>
  <!-- Message quand il n'y a pas de recettes -->
  <div class="card shadow-sm">
    <div class="card-body text-center py-5">
      <i class="bi bi-journal-text text-muted" style="font-size: 4rem;"></i>
      <h4 class="mt-3">Aucune recette</h4>
      <p class="text-muted mb-4">Créez votre première recette pour commencer à calculer vos coûts matières.</p>
      <%= link_to new_recipe_path, class: "btn btn-primary btn-lg" do %>
        <i class="bi bi-plus-circle"></i> Créer ma première recette
      <% end %>
    </div>
  </div>
<% else %>
  <!-- Cartes de recettes -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% @recipes.each do |recipe| %>
      <div class="col">
        <div class="card h-100 shadow-sm hover-shadow">
          <div class="card-header bg-white border-bottom">
            <h5 class="card-title mb-0"><%= recipe.name %></h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <small class="text-muted d-block mb-2">
                <i class="bi bi-bag"></i> <%= recipe.recipe_ingredients.count %> ingrédient<%= recipe.recipe_ingredients.count > 1 ? 's' : '' %>
              </small>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-muted">Coût matière :</span>
                <% if recipe.cached_total_cost.present? && recipe.cached_total_cost > 0 %>
                  <span class="badge <%= recipe.cached_total_cost > 30 ? 'bg-warning text-dark' : 'bg-success' %> fs-6">
                    <%= number_to_currency(recipe.cached_total_cost, unit: "€", format: "%n %u") %>
                  </span>
                <% else %>
                  <span class="badge bg-light text-dark">-</span>
                <% end %>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-muted">Poids total :</span>
                <% if recipe.cached_total_weight.present? && recipe.cached_total_weight > 0 %>
                  <span class="badge bg-light text-dark">
                    <%= number_with_precision(recipe.cached_total_weight, precision: 3) %> kg
                  </span>
                <% else %>
                  <span class="badge bg-light text-dark">-</span>
                <% end %>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted fw-bold">Coût au kilo :</span>
                <% if recipe.cached_cost_per_kg.present? && recipe.cached_cost_per_kg > 0 %>
                  <span class="badge bg-primary fs-6">
                    <%= number_to_currency(recipe.cached_cost_per_kg, unit: "€", format: "%n %u") %> / kg
                  </span>
                <% else %>
                  <span class="badge bg-light text-dark">-</span>
                <% end %>
              </div>
            </div>
            <hr>
            <p class="card-text text-muted small mb-0">
              <i class="bi bi-clock"></i> Mise à jour : <%= l(recipe.updated_at, format: :short) %>
            </p>
          </div>
          <div class="card-footer bg-white border-top">
            <div class="d-flex gap-2">
              <%= link_to recipe_path(recipe), class: "btn btn-sm btn-outline-primary flex-fill" do %>
                <i class="bi bi-eye"></i> Voir
              <% end %>
              <%= link_to edit_recipe_path(recipe), class: "btn btn-sm btn-outline-secondary flex-fill" do %>
                <i class="bi bi-pencil"></i> Modifier
              <% end %>
              <%= button_to duplicate_recipe_path(recipe), method: :post, class: "btn btn-sm btn-outline-info", title: "Dupliquer" do %>
                <i class="bi bi-files"></i>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<style>
  .hover-shadow:hover {
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
    transition: box-shadow 0.3s ease;
  }
</style>
