<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><%= link_to "Accueil", root_path %></li>
    <li class="breadcrumb-item active">Référentiel Produits</li>
  </ol>
</nav>

<!-- En-tête -->
<div class="row mb-4">
  <div class="col-md-8">
    <h2><i class="bi bi-box-seam"></i> Référentiel Produits</h2>
    <p class="text-muted">Gérez vos produits et leurs prix d'achat</p>
  </div>
  <div class="col-md-4 text-end">
    <%= link_to new_product_path, class: "btn btn-primary btn-lg" do %>
      <i class="bi bi-plus-circle"></i> Nouveau Produit
    <% end %>
  </div>
</div>

<!-- Barre de recherche -->
<div class="row mb-3">
  <div class="col-md-6">
    <div class="input-group">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <input type="text" class="form-control" placeholder="Rechercher un produit..." disabled>
    </div>
  </div>
  <div class="col-md-6 text-end">
    <span class="badge bg-secondary fs-6"><%= @products.count %> produit<%= @products.count > 1 ? 's' : '' %></span>
  </div>
</div>

<!-- Tableau des produits -->
<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th style="width: 40%">
              Nom du produit
              <i class="bi bi-arrow-down-up text-muted" style="font-size: 0.8rem"></i>
            </th>
            <th style="width: 20%">
              Prix moy. / kg
              <i class="bi bi-arrow-down-up text-muted" style="font-size: 0.8rem"></i>
            </th>
            <th style="width: 15%">Unité de base</th>
            <th style="width: 15%">Recettes</th>
            <th style="width: 10%" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if @products.empty? %>
            <tr>
              <td colspan="5" class="text-center py-4">
                <p class="text-muted mb-2">Aucun produit dans votre référentiel</p>
                <%= link_to new_product_path, class: "btn btn-primary" do %>
                  <i class="bi bi-plus-circle"></i> Créer votre premier produit
                <% end %>
              </td>
            </tr>
          <% else %>
            <% @products.each do |product| %>
              <tr>
                <td><strong><%= product.name %></strong></td>
                <td><span class="text-primary fw-bold"><%= number_to_currency(product.avg_price_per_kg, unit: "€", format: "%n %u") %></span></td>
                <td>
                  <span class="badge bg-info"><%= product.base_unit %></span>
                </td>
                <td>
                  <% recipes_count = product.recipe_components.count %>
                  <% if recipes_count > 0 %>
                    <span class="badge bg-secondary"><%= recipes_count %> recette<%= recipes_count > 1 ? 's' : '' %></span>
                  <% else %>
                    <span class="badge bg-light text-dark">0 recette</span>
                  <% end %>
                </td>
                <td class="text-end">
                  <%= link_to edit_product_path(product), class: "btn btn-sm btn-outline-primary", title: "Modifier" do %>
                    <i class="bi bi-pencil"></i>
                  <% end %>
                  <%= button_to product_path(product),
                      method: :delete,
                      class: "btn btn-sm btn-outline-danger",
                      title: "Supprimer",
                      form: { data: { turbo_confirm: "Êtes-vous sûr de vouloir supprimer ce produit ?" } } do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
