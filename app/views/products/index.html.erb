<%# En-tête %>
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="mb-0">Produits</h4>
  <%= link_to new_product_path, class: "btn btn-primary" do %>
    <i class="bi bi-plus-lg"></i> Nouveau produit
  <% end %>
</div>

<%# Barre de recherche %>
<%= form_with url: products_path, method: :get, class: "mb-4" do |f| %>
  <div class="input-group" style="max-width: 400px;">
    <%= f.text_field :search,
          value: params[:search],
          placeholder: "Rechercher un produit...",
          class: "form-control" %>
    <%= f.submit "Rechercher", class: "btn btn-outline-secondary" %>
    <% if params[:search].present? %>
      <%= link_to "✕", products_path, class: "btn btn-outline-danger" %>
    <% end %>
  </div>
<% end %>

<%# Grille de cards %>
<% if @products.any? %>
  <div class="row row-cols-1 row-cols-md-3 g-4">
    <% @products.each do |product| %>
      <div class="col" style="position: relative; z-index: 1;">
        <%= render "products/product_card", product: product %>

        <div class="collapse" id="purchases_collapse_<%= product.id %>">
          <%= turbo_frame_tag "purchases_#{product.id}" do %>
            <%= render "product_purchases/purchases_section",
                  product: product,
                  purchases: product.product_purchases.order(:created_at),
                  new_purchase: ProductPurchase.new,
                  suppliers: current_user.suppliers.active %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <p class="text-muted text-center mt-4">
    <% if params[:search].present? %>
      Aucun produit trouvé pour "<%= params[:search] %>".
    <% else %>
      Aucun produit pour le moment.
    <% end %>
  </p>
<% end %>
