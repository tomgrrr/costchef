<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><%= link_to "Accueil", root_path %></li>
    <li class="breadcrumb-item"><%= link_to "Référentiel Produits", products_path %></li>
    <li class="breadcrumb-item active"><%= @product.name %></li>
  </ol>
</nav>

<!-- En-tête -->
<div class="row mb-4">
  <div class="col-md-8">
    <h2><i class="bi bi-box-seam"></i> <%= @product.name %></h2>
    <div class="d-flex gap-2 mt-2">
      <span class="badge bg-info"><i class="bi bi-clock"></i> Créé le <%= l(@product.created_at, format: :long) %></span>
      <% if @product.updated_at != @product.created_at %>
        <span class="badge bg-secondary"><i class="bi bi-pencil"></i> Modifié le <%= l(@product.updated_at, format: :long) %></span>
      <% end %>
    </div>
  </div>
  <div class="col-md-4 text-end">
    <div class="btn-group" role="group">
      <%= link_to edit_product_path(@product), class: "btn btn-primary" do %>
        <i class="bi bi-pencil"></i> Modifier
      <% end %>
      <%= button_to product_path(@product),
          method: :delete,
          class: "btn btn-danger",
          form: { data: { turbo_confirm: "Êtes-vous sûr de vouloir supprimer ce produit ?" } } do %>
        <i class="bi bi-trash"></i> Supprimer
      <% end %>
    </div>
  </div>
</div>

<div class="row">
  <!-- Colonne gauche : Informations -->
  <div class="col-md-4">
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Informations</h5>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
          <span class="text-muted">Prix unitaire</span>
          <strong class="text-primary fs-4"><%= number_to_currency(@product.price, unit: "€", format: "%n %u") %></strong>
        </div>
        <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
          <span class="text-muted">Unité</span>
          <strong>
            <% if @product.unit.present? %>
              <span class="badge bg-info"><%= @product.unit %></span>
            <% else %>
              <span class="text-muted">Non spécifiée</span>
            <% end %>
          </strong>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">Utilisé dans</span>
          <strong><%= @product.recipes.count %> recette(s)</strong>
        </div>
      </div>
    </div>

    <%= link_to products_path, class: "btn btn-outline-secondary w-100" do %>
      <i class="bi bi-arrow-left"></i> Retour à la liste
    <% end %>
  </div>

  <!-- Colonne droite : Recettes utilisant ce produit -->
  <div class="col-md-8">
    <div class="card shadow-sm">
      <div class="card-header bg-white">
        <h5 class="mb-0"><i class="bi bi-journal-text"></i> Recettes utilisant ce produit</h5>
      </div>
      <div class="card-body">
        <% if @product.recipes.any? %>
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Recette</th>
                  <th class="text-center">Quantité utilisée</th>
                  <th class="text-end">Coût dans la recette</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% @product.recipe_ingredients.includes(:recipe).each do |ri| %>
                  <tr>
                    <td><strong><%= ri.recipe.name %></strong></td>
                    <td class="text-center">
                      <span class="badge bg-light text-dark">
                        <%= number_with_precision(ri.quantity, precision: 3) %> <%= @product.unit %>
                      </span>
                    </td>
                    <td class="text-end">
                      <strong class="text-primary">
                        <%= number_to_currency(ri.quantity * @product.price, unit: "€", format: "%n %u") %>
                      </strong>
                    </td>
                    <td class="text-end">
                      <%= link_to recipe_path(ri.recipe), class: "btn btn-sm btn-outline-primary" do %>
                        <i class="bi bi-eye"></i>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <div class="text-center py-4">
            <p class="text-muted mb-0">
              <i class="bi bi-info-circle"></i> Ce produit n'est utilisé dans aucune recette pour le moment.
            </p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
