<%= turbo_frame_tag "product_#{product.id}" do %>
  <div class="product-card">
    <%# Hover actions %>
    <div class="card-actions">
      <%= link_to edit_product_path(product),
            class: "action-btn",
            data: { turbo_frame: "_top" },
            title: "Modifier" do %>
        <i class="bi bi-pencil"></i>
      <% end %>

      <%= button_to product_path(product),
            method: :delete,
            form: { data: { turbo_confirm: "Supprimer ce produit ?", turbo_frame: "_top" } },
            class: "action-btn danger #{'disabled' if product.used_in_recipes?}",
            title: product.used_in_recipes? ? "Utilisé dans #{product.recipes_count} recette(s)" : "Supprimer" do %>
        <i class="bi bi-trash"></i>
      <% end %>
    </div>

    <%# Unit badge %>
    <div class="p-unit"><%= product.base_unit %></div>

    <%# Name %>
    <div class="p-name"><%= product.name %></div>

    <%# Price %>
    <div class="p-price">
      <% if product.avg_price_per_kg.to_f > 0 %>
        <%= number_with_precision(product.avg_price_per_kg, precision: 2) %> €/kg
      <% else %>
        <span class="badge-warning-sl">
          <i class="bi bi-exclamation-triangle"></i> Prix non défini
        </span>
      <% end %>
    </div>

    <%# Meta %>
    <div class="p-meta">
      <%= product.product_purchases.active.count %> conditionnement(s) actif(s)
    </div>

    <%# Stock button %>
    <button class="stock-btn"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#purchases_collapse_<%= product.id %>"
            aria-expanded="false">
      <i class="bi bi-box-seam"></i> Gérer les conditionnements
    </button>
  </div>
<% end %>
