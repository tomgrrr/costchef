<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><%= link_to "Accueil", root_path %></li>
    <li class="breadcrumb-item active">Fournisseurs</li>
  </ol>
</nav>

<!-- En-tête -->
<div class="row mb-4">
  <div class="col-md-8">
    <h2><i class="bi bi-truck"></i> Fournisseurs</h2>
    <p class="text-muted">Gérez vos fournisseurs</p>
  </div>
  <div class="col-md-4 text-end">
    <%= link_to new_supplier_path, class: "btn btn-primary btn-lg" do %>
      <i class="bi bi-plus-circle"></i> Nouveau Fournisseur
    <% end %>
  </div>
</div>

<!-- Compteur -->
<div class="row mb-3">
  <div class="col-md-12 text-end">
    <span class="badge bg-secondary fs-6"><%= @suppliers.count %> fournisseur<%= @suppliers.count > 1 ? 's' : '' %></span>
  </div>
</div>

<!-- Tableau des fournisseurs -->
<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th style="width: 35%">Nom</th>
            <th style="width: 15%">Statut</th>
            <th style="width: 15%">Nb achats</th>
            <th style="width: 35%" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if @suppliers.empty? %>
            <tr>
              <td colspan="4" class="text-center py-4">
                <p class="text-muted mb-2">Aucun fournisseur enregistré</p>
                <%= link_to new_supplier_path, class: "btn btn-primary" do %>
                  <i class="bi bi-plus-circle"></i> Créer votre premier fournisseur
                <% end %>
              </td>
            </tr>
          <% else %>
            <% @suppliers.each do |supplier| %>
              <tr>
                <td><strong><%= supplier.name %></strong></td>
                <td>
                  <% if supplier.active? %>
                    <span class="badge bg-success">Actif</span>
                  <% else %>
                    <span class="badge bg-warning text-dark">Inactif</span>
                  <% end %>
                </td>
                <td>
                  <span class="badge bg-light text-dark"><%= supplier.product_purchases.count %> achat<%= supplier.product_purchases.count > 1 ? 's' : '' %></span>
                </td>
                <td class="text-end">
                  <%= link_to supplier_path(supplier), class: "btn btn-sm btn-outline-primary", title: "Voir" do %>
                    <i class="bi bi-eye"></i>
                  <% end %>
                  <%= link_to edit_supplier_path(supplier), class: "btn btn-sm btn-outline-secondary", title: "Modifier" do %>
                    <i class="bi bi-pencil"></i>
                  <% end %>
                  <%= button_to deactivate_supplier_path(supplier),
                      method: :patch,
                      class: "btn btn-sm btn-outline-warning",
                      title: supplier.active? ? "Désactiver" : "Réactiver" do %>
                    <i class="bi bi-<%= supplier.active? ? 'pause-circle' : 'play-circle' %>"></i>
                  <% end %>
                  <% if supplier.has_purchases? %>
                    <%= button_to force_destroy_supplier_path(supplier),
                        method: :delete,
                        class: "btn btn-sm btn-outline-danger",
                        title: "Suppression forcée (avec achats)",
                        form: { data: { turbo_confirm: "Attention : cela supprimera le fournisseur ET tous ses achats. Les prix seront recalculés. Continuer ?" } } do %>
                      <i class="bi bi-trash"></i>
                    <% end %>
                  <% else %>
                    <%= button_to supplier_path(supplier),
                        method: :delete,
                        class: "btn btn-sm btn-outline-danger",
                        title: "Supprimer",
                        form: { data: { turbo_confirm: "Êtes-vous sûr de vouloir supprimer ce fournisseur ?" } } do %>
                      <i class="bi bi-trash"></i>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
