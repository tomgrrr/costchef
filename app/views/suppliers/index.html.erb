<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Fournisseurs</h1>
  <%= link_to 'Nouveau fournisseur', new_supplier_path, class: 'btn btn-primary' %>
</div>

<div class="mb-3">
  <span class="badge bg-success">Actifs : <%= @active_suppliers.size %></span>
  <span class="badge bg-secondary">Inactifs : <%= @inactive_suppliers.size %></span>
</div>

<% if @active_suppliers.empty? && @inactive_suppliers.empty? %>
  <p class="text-muted">Aucun fournisseur pour le moment.</p>
<% else %>
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Statut</th>
        <th>Conditionnements</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @active_suppliers.each do |supplier| %>
        <tr>
          <td><%= supplier.name %></td>
          <td><span class="badge bg-success">Actif</span></td>
          <td><%= supplier.product_purchases.count %></td>
          <td class="d-flex gap-1">
            <%= link_to 'Modifier', edit_supplier_path(supplier), class: 'btn btn-sm btn-outline-primary' %>
            <%= button_to 'Désactiver', deactivate_supplier_path(supplier), method: :post, class: 'btn btn-sm btn-warning' %>
            <% if supplier.has_purchases? %>
              <button type="button" class="btn btn-sm btn-outline-danger" disabled title="Désactivez d'abord ou forcez la suppression">Supprimer</button>
            <% else %>
              <%= button_to 'Supprimer', supplier_path(supplier), method: :delete, data: { turbo_confirm: 'Supprimer ce fournisseur ?' }, class: 'btn btn-sm btn-outline-danger' %>
            <% end %>
          </td>
        </tr>
      <% end %>
      <% @inactive_suppliers.each do |supplier| %>
        <tr class="opacity-50">
          <td><%= supplier.name %></td>
          <td><span class="badge bg-secondary">Inactif</span></td>
          <td><%= supplier.product_purchases.count %></td>
          <td class="d-flex gap-1">
            <%= link_to 'Modifier', edit_supplier_path(supplier), class: 'btn btn-sm btn-outline-primary' %>
            <%= button_to 'Réactiver', activate_supplier_path(supplier), method: :post, class: 'btn btn-sm btn-success' %>
            <%= button_to 'Forcer la suppression', supplier_path(supplier, force: true), method: :delete, data: { turbo_confirm: 'Supprimer ce fournisseur et tous ses conditionnements définitivement ? Cette action est irréversible.' }, class: 'btn btn-sm btn-danger' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
